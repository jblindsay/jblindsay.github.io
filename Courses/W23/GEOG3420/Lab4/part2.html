<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Part 2: Multi-spectral Image Classification - GEOG3420 W23 Lab 4</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="part1.html"><strong aria-hidden="true">2.</strong> Part 1: Normalized Difference Indices</a></li><li class="chapter-item expanded "><a href="part2.html" class="active"><strong aria-hidden="true">3.</strong> Part 2: Multi-spectral Image Classification</a></li><li class="chapter-item expanded "><a href="part3.html"><strong aria-hidden="true">4.</strong> Part 3: Cleaning the Class Map</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">GEOG3420 W23 Lab 4</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="part-2-multi-spectral-image-classification"><a class="header" href="#part-2-multi-spectral-image-classification">Part 2: Multi-spectral Image Classification</a></h1>
<blockquote>
<p>It is strongly recommended that you complete the following reading before continuing, with particular focus on the sections addressing supervised classification and <em>more advanced approaches to image classification</em> (i.e., decision trees).</p>
<p><strong>Readings:</strong> Mather and Koch (2023), Chapter 7 Classification, <em>Computer Processing of Remotely-Sensed Imagery</em>. </p>
</blockquote>
<p>Many supervised and unsupervised image classification methods exist. Unfortunately, no one method to image classification is universally better than other methods (although some will often perform well under many conditions) and an image classification exercise often involves experimenting with different techniques to determine optimal methods for a particular image data set and classification scheme.</p>
<p>Let's begin our image classification experimentation by running the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#min_dist_classification">minimum distance classification method</a> on our Landsat 9 data set. Create a file called <em>classification.py</em> and copy the following script into it and then run the script (after modifying it as required).</p>
<p><em>classification.py</em></p>
<pre><code class="language-python">import os
import whitebox_workflows

wbe = whitebox_workflows.WbEnvironment('floating-license-ID') # Initialize Whitebox

try:
    # declare your working directory as a variable
    wbe.working_directory = &quot;/path/to/lab/data&quot; # BE SURE TO UPDATE THIS
    assert(os.path.isdir(wbe.working_directory))

    wbe.verbose = True # Let's print the output of each tool

    # Read the 7 bands of data into a variable named 'band_data'
    print('Reading band data...')
    band_data = wbe.read_rasters(
        'LC09_L1TP_018030_20220614_20220615_02_T1_B1.tif',
        'LC09_L1TP_018030_20220614_20220615_02_T1_B2.tif',
        'LC09_L1TP_018030_20220614_20220615_02_T1_B3.tif',
        'LC09_L1TP_018030_20220614_20220615_02_T1_B4.tif',
        'LC09_L1TP_018030_20220614_20220615_02_T1_B5.tif',
        'LC09_L1TP_018030_20220614_20220615_02_T1_B6.tif',
        'LC09_L1TP_018030_20220614_20220615_02_T1_B7.tif',
    )

    # Read in the training data
    print('Reading training data...')
    training_data = wbe.read_vector('training_data.shp')

    # Perform a minimum-distance classification
    print('Performing min-dist classification...')
    min_dist = wbe.min_dist_classification(
        input_rasters = band_data, 
        training_data = training_data, 
        class_field_name = 'CLASS', 
        dist_threshold = 3.0
    )

    # Save the output raster to disc
    wbe.write_raster(min_dist, 'min_dist.tif', compress=True)

    print(&quot;Operation complete!&quot;) # Provide some sort of indication that the job is done.

except Exception as e:
    print(f&quot;Exception: {e}&quot;)

finally:
    print(wbe.check_in_license('floating-license-ID')) # Check your license back in.
</code></pre>
<p>When the script has completed, display <strong>min_dist.tif</strong> using QGIS.</p>
<blockquote>
<p>2.1. Include a map of the min-dist classification for the Guelph and surroundings area. Use a colour scheme for your class map similar to the following. (1 mark)</p>
<p><img src="img/colour_scheme.png" alt="colour_scheme.tif image" /></p>
</blockquote>
<p>Visually evaluate the accuracy of the classification by comparing the class map with the natural colour composite image. You may also wish to overlay an OpenStreetMaps layer for comparison, which is particularly useful for assessing how well water bodies, urban areas, and possibly forest (although there are temporal issue because of urban expansion and de/reforestation).</p>
<blockquote>
<p>2.2. How well did the min-dist classification perform for mapping water bodies, urban areas (both residential and industrial/commercial), and forest? (3 marks)</p>
</blockquote>
<p>Now modify the classification script above to use the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#parallelepiped_classification">parallelepiped classification method</a> instead (you may just want to comment out the min-dist classification part above, in case you need to run it again):</p>
<pre><code class="language-python"># Perform a parallelepiped classification
print('Performing parallelipiped classification...')
parallelepiped = wbe.parallelepiped_classification(
    input_rasters = band_data, 
    training_data = training_data, 
    class_field_name = 'CLASS'
)

# Save the output raster to disc
wbe.write_raster(parallelepiped, 'parallelepiped.tif', compress=True)
</code></pre>
<blockquote>
<p>2.3. Include a map of the parallelepiped classification for same area around Guelph used above. (<strong>Hint</strong> if you zoom into your area of interest around Guelph, create a new vector, and digitize two points in opposing corners, you'll be able to zoom to extent and return to the same spatial extent whenever required; 1 mark)</p>
</blockquote>
<p>Now modify the classification script to use the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#knn_classification">k-Nearest Neighbour (kNN) classification method</a>:</p>
<pre><code class="language-python"># Perform a kNN classification
print('Performing kNN classification...')
knn = wbe.knn_classification(
    input_rasters = band_data, 
    training_data = training_data,
    class_field_name = 'CLASS',
    scaling_method = &quot;Standardize&quot;, 
    k = 5, 
    test_proportion = 0.2,
    use_clipping = True, 
    create_output = True
)

# Save the output raster to disc
wbe.write_raster(knn, 'knn.tif', compress=True)
</code></pre>
<p>You'll notice that unlike with the min-dist and parallelepiped classifications, kNN outputs a measure of the accuracy of the classification. It does this by developing the classification model with a subset of the training data and setting aside a certain number of the training pixels (20% in our script above, <code>test_proportion = 0.2</code>) for evaluating the accuracy. The training data are randomly assigned to either training or testing groups and therefore the class map that is generated will be different each time (this also means that no two students should have the same class map and you shouldn't be concerned if you map is slightly different than that of the student next to you). The classification accuracy data will be reported at the terminal when you run your script.</p>
<blockquote>
<p>2.4. What is the difference between the <em>overall accuracy</em> and the <em>kappa index</em> for classification assessment? (1 mark)</p>
<p>2.5. Describe how the kNN classification method works. What is the impact of increasing the value of <code>k</code> to 8 or decreasing <code>k</code> to 1 on our classification model? (3 marks) </p>
<p>2.6. Include a map of the kNN classification for same area around Guelph used above. (1 mark)</p>
</blockquote>
<p>Now modify the classification script to use the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#random_forest_classification">random forest classification method</a>:</p>
<pre><code class="language-python"># Perform a random forest classification
print('Performing random forest classification...')
rf = wbe.random_forest_classification(
    input_rasters = band_data, 
    training_data = training_data, 
    class_field_name = 'CLASS', 
    split_criterion = &quot;gini&quot;, 
    n_trees = 100, 
    min_samples_leaf = 1, 
    min_samples_split = 2, 
    test_proportion = 0.2, 
    create_output = True
)

# Save the output raster to disc
wbe.write_raster(rf, 'random_forest.tif', compress=True)
</code></pre>
<p>Random forest classification is the slowest-running of the classification methods that we're evaluating but often provides very good results. The processing time is greatly affected by the <code>n_trees</code> parameter (decreasing this will speed up the processing but may decrease the accuracy). Like kNN, random forest classification also outputs classification accuracy statistics.</p>
<blockquote>
<p>2.7. Generally, the accuracy/kappa for the training data will be higher than the equivalent accuracy/kappa statistics for the test data. Why do you think this is? Which of the two groups of reported statistics (training or test) do you think is more important and why? (2 mark)</p>
<p>2.8. Include a map of the random forest classification for same area around Guelph used above. (1 mark)</p>
<p>2.9. Consider the reported 'Variable Permutation Importance'. Which band was found to be the most important for the classification and which was the least? Why might it be that a certain band may contribute very little to the classification model? (4 marks)</p>
<p>2.10. After inspecting each of the four classification maps, which of classification method do you feel performed the best for this data set and why? Provide example screenshots to illustrate your answer. (3 marks)</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="part1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="part3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="part1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="part3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
