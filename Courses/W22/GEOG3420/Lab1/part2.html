<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Part 2: Multispectral Imagery Data - GEOG3420 W22 Lab 1</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="part1.html"><strong aria-hidden="true">2.</strong> Part 1: Acquiring Satellite Imagery</a></li><li class="chapter-item expanded "><a href="part2.html" class="active"><strong aria-hidden="true">3.</strong> Part 2: Multispectral Imagery Data</a></li><li class="chapter-item expanded "><a href="part3.html"><strong aria-hidden="true">4.</strong> Part 3: Colour Composite Images</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">GEOG3420 W22 Lab 1</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="part-2-multispectral-imagery-data"><a class="header" href="#part-2-multispectral-imagery-data">Part 2: Multispectral Imagery Data</a></h1>
<p>In this course, we will be manipulating and analyzing remotely sensed data using the <a href="https://www.whiteboxgeo.com/geospatial-software/">WhiteboxTools</a> advanced geospatial analysis platform. You are free to use whatever software you are familiar with for visualizing the imagery data in the labs, including <a href="https://www.qgis.org/en/site/">QGIS</a>, ArcGIS, or any other spatial analysis software capable of displaying georeferenced imagery data. See the <strong>Before you begin</strong> section of the introduction for more details.</p>
<p>After you have downloaded the data associated with this lab assignment from the CourseLink page, decompress (unzip) the data into a working directory that you have created to dedicate to this assignment. Open the contents of this folder and examine the files contained within. These data are the multiple bands, in GeoTIFF image format, of a Landsat scene acquired June 24, 2017. The scene covers a region of southern Ontario spanning from St. Thomas in the southwest to east Toronto.</p>
<blockquote>
<p>In the field of remote sensing, the word <em>band</em> refers to a single image contained within a multispectral or hyperspectral dataset. A band corresponds to a single, usually narrow, region of the electromagnetic spectrum. Band images are usually greyscale and display information about the relative brightness of the earth's surface at the pixel site across the range of wavelengths associated with the band. For example, in a Landsat 8 band 3 image, a bright white pixel corresponds to a surface material that is reflecting a significant amount of radiation in the 0.525 to 0.600 Âµm band of wavelengths, which the human eye interprets as green light. A dark coloured pixel, by comparison, would indicate that not much green light is being reflected by that surface material. Some bands within multispectral datasets are associated with regions of the spectrum that fall outside of the visible region (e.g. near-infrared, shortwave infrared, and thermal infrared). Interpreting the relatively brightnesses of pixels within multiple band images can tell you a great deal about the nature of the surface at those sites. This is the basis of multispectral remote sensing data analysis.</p>
</blockquote>
<p>Now open the metadata file <code>LC08_L1TP_018030_20170624_20170713_01_T1_MTL.txt</code> using a text editor such as Notepad or TextEdit or VS Code. This file contains a wealth of information describing the acquisition details and processing that has been carried out on these data.</p>
<blockquote>
<p>2.1. What proportion of the land contained within the scene was covered with clouds at the time of acquisition? (1 mark)</p>
<p>2.2. What are the path and row numbers of the scene? (2 marks)</p>
</blockquote>
<p>Using your data visualization software (QGIS, ArcGIS, etc.) display the Band 2 and Band 6 images (<code>LC08_L1TP_018030_20170624_20170713_01_T1_B2.TIF</code> and <code>LC08_L1TP_018030_20170624_20170713_01_T1_B6.TIF</code>). Your Band 2 image probably looks something like this:</p>
<p><img src="img/band2_raw.png" alt="Band2 raw" /></p>
<p>There are a couple of issues with the images as they are currently displayed. First, notice the large black triangular regions around the edges of the data. These areas are filled with a background value of zero, however, they are not being recognized as <em>NoData</em> values. This is partly the reason for the second issue with the displayed images, and that is the poor contrast; the areas of clouds are quite bright but all other areas have a uniformly intermediate brightness, causing very little contrast. The contrast of these two images is inadequate because the greytones used to render the images are being scaled to their minimum (those background zero values) and maximum (cloud) values. <strong>You should close the displayed images before moving on.</strong></p>
<p>To solve the contrast problem, we will first set the NoData value in the images to '0', so that the minium displayed value is not taken by the background. To do this, we will use WhiteboxTool's <a href="https://www.whiteboxgeo.com/manual/wbt_book/available_tools/data_tools.html#SetNodataValue"><strong>SetNodataValue</strong></a> tool. We will first access WhiteboxTools using the <a href="https://www.whiteboxgeo.com/manual/wbt_book/whitebox_tools_runner.html"><em>WhiteboxTools Runner</em></a>. If you haven't already done so, <a href="https://www.whiteboxgeo.com/download-whiteboxtools/">download</a> the most recent version of WhiteboxTools, which includes the <em>WhiteboxTools Runner</em> user interface. You may launch the <em>Runner</em> (assuming you have Python 3 installed on your machine) by opening a command prompt (i.e. terminal application) and typing the following:</p>
<pre><code>cd /path/to/whitebox_runner/script/
python3 wb_runner.py
</code></pre>
<blockquote>
<p><strong>Note</strong>: The <code>cd</code> command will change the working directory of your terminal. Replace <code>/path/to/whitebox_runner/script/</code> with your directory path to the WhiteboxTools application. On Windows, you use <code>\</code> as a path separator character and <code>/</code> on all other operating systems. The <code>python3</code> command is used in place of the more common <code>python</code> command only if Python 2 is the default version of Python on your system.</p>
</blockquote>
<p>Alternatively, you may also be able to launch the WhiteboxTools Runner simply by right-clicking the wb_runner.py file (contained within the WBT folder that you have downloaded), and selecting <em>Open With</em> =&gt; <em>Python Launcher</em>. At least on the Mac that I am writing this lab on, this method of launching the Runner works well.</p>
<p>You should see the following user interface displayed, after clicking the <em>SetNodataValue</em> menu item on the left:</p>
<p><img src="img/runner.png" alt="WhiteboxTools Runner" /></p>
<p>Enter <code>LC08_L1TP_018030_20170624_20170713_01_T1_B2.TIF</code> as the input file and call the output file <code>band2.tif</code>; the background value can be left to the default of 0. Press the <em>Run</em> button and once the application is complete, display the <code>band2.tif</code> image (close any open images that you currently have). You should notice that the black triangles around the edges have disappeared now. </p>
<p><img src="img/band2.png" alt="Band 2 NoData set" /></p>
<p><em>As a caution</em>, the images that we are using in this lab are very large data files and we will need substantial memory resources to process. While the computers in the undergraduate computing lab are able to handle these requirements, it is possible, if you are using your own laptop for completing this assignment, that you will run into out-of-memory errors. If this is the case, you will have no alternative but to use a computer with more memory (RAM, not hard-drive space). This will likely be the case throughout the semester as the processing of remotely sensed imagery often requires powerful workstations. If you find yourself needing to use the lab computers while working remotely, just a reminder that you can log into the Hutt 231 computers remotely at any time through the <a href="https://www.lib.uoguelph.ca/using-library/printing-computing/remote-access-library-computers">Library webpage</a>.</p>
<p>The WhiteboxTools Runner provides a very useful way of interacting with the WhiteboxTools library when we need to run a few functions but any user-interface application becomes cumbersome when we have a complex workflow or are repeating the same operation numerous times. In our case, we will need to perform the same <code>SetNodataValue</code> operation on all ten bands of the Landsat dataset. Doing this manually would be tedious and this is a perfect example of the type of repetitive operation that scripting is ideally suited to. </p>
<p>We are going to call the same <code>SetNodataValue</code> tool from a Python script. <strong>Your TA will provide a demonstration on how to use Python and the open-source Python text editor IDLE (installed on the computers in the lab) to interact with the WhiteboxTools library.</strong> We will be writing our Python code using IDLE, a very basic Python development environment, which is already installed on the computers in Hutt 231. If you are more comfortable with an alternative Python coding environment, that is fine as well. If you are using your own computer to complete this lab, you will also need to have the latest version of Python 3 installed. If you do not, then simply visit the Python website, download and install the latest version of Python in the 3.x series. <strong>Notice, you cannot use Python 2.x to complete this lab. IDLE is always installed along-side Python.</strong></p>
<p>For further reference using Python with WhiteboxTools, please see <a href="https://www.whiteboxgeo.com/manual/wbt_book/python_scripting/scripting.html"><em>Interfacing With Python</em></a> in the WhiteboxTools user manual. <strong>NOTE</strong>: This will take some time to become comfortable with the workflow of interacting with WhiteboxTools using Python scripting (you may learn more about the Python language by searching for any of the numerous free online Python tutorials). I do not expect that you will become an expert in Python programming by the end of this course; we are only hoping that you will gain a basic level of competency with using Python to interact with WhiteboxTools in this time. However, it is an essential learning outcome of this lab and will be the basis of a great deal of remote sensing applications that we will use throughout this series of lab assignments this semester. </p>
<p>Once you are familiar with how to write Python scripts using WhiteboxTools and IDLE, create a directory named <code>Lab1</code> and paste the WhiteboxTools <code>WBT</code> folder into this directory. Now, using IDLE, create a new file within your Lab1 folder, being sure to save it as <code>__init__.py</code> (those are two underscores preceding and following the word <em>init</em>). This file will allows us to <a href="https://docs.python.org/3/tutorial/modules.html#packages">import Python modules</a> contained within the <code>WBT</code> subdirectory of <code>Lab1</code>; the <code>__init__.py</code> (those are two leading and trailing underscore characters) does not need to contain anything. Now create a second script file within IDLE called <code>set_nodata.py</code>, which will contain our code. Your directory structure should look something like the following:</p>
<p><img src="img/directory.png" alt="File directory" /></p>
<p>Finally, paste the following code into your <code>set_nodata.py</code>:</p>
<pre><code class="language-python">import os
from WBT.whitebox_tools import WhiteboxTools


def main():
    wbt = WhiteboxTools()

    # declare your working directory as a variable
    wdir = &quot;Your working directory here&quot;
    assert(os.path.isdir(wdir))
    wbt.work_dir = wdir

    for bandNum in range(1, 11):
        print(&quot;Working on band {}&quot;.format(bandNum))
        inFile = &quot;LC08_L1TP_018030_20170624_20170713_01_T1_B{}.TIF&quot;.format(bandNum)
        outFile = &quot;band{}.tif&quot;.format(bandNum)
        wbt.set_nodata_value(inFile, outFile, 0.0)

    print(&quot;All done!&quot;)


main()
</code></pre>
<blockquote>
<p><strong>Notes</strong>: Python is a space-sensitive programming language and you need to have the indentations absolutely correct in your script for it to run correctly. This is something that can often go wrong when you are copying and pasting code into a script file. Also, you will need to change the line <code>working_dir = &quot;/path/to/landsat/data/&quot;</code> to the folder containing your image data. <strong>Important if you are running this script on a computer running Microsoft Windows</strong>: Windows uses the backslash-slash (\) as the directory path separator but this is famously difficult for writing strings (i.e. text variables) containing file paths because \ is an <a href="https://en.wikipedia.org/wiki/Escape_character">escape character</a> in all programming languages. To deal with this, you must represent your variables containing paths in one of the following ways:</p>
<pre><code class="language-python"># Uses an escaped forward character (\\)
wbt.work_dir = &quot;\\path\\to\\landsat\\data\\&quot;

# Uses a 'raw string' in which '\' is interpreted without escaped characters.
# Because raw strings can't end with a '\', we must use double &quot; at the end.
wbt.work_dir = r&quot;\path\to\landsat\data\&quot;&quot;

# Python should also properly interpret directories using the forward
# slash on Windows.
wbt.work_dir = &quot;/path/to/landsat/data/&quot;
</code></pre>
</blockquote>
<p>The script above first sets up the WhiteboxTools Python environment, importing the library and then setting up the working directory. The script then uses a <code>for</code> loop to run the  <code>SetNodataValue</code> tool that we used previously 10 times, once for each band in the data. We use the loop iteration variable <code>bandNum</code> to create appropriate input and output file names associated with each of the 10 bands. It's a pretty short script, but it shows the power of being able to call remote sensing functions from a scripting language like Python. Imagine if instead of 10 multispectral bands, we were working with hundreds of bands in a hyperspectral dataset. Being able to write scripts like the one above significantly improves your competency as a remote sensing analyst.</p>
<p>Execute the script (see the <em>Run</em> =&gt; <em>Run Module</em> menu) and allow it to complete the processing of each of the output images.</p>
<blockquote>
<p>2.3. Analyze the above script and provide line-by-line description of what the script is does (10 marks; the TA will mark your answer for accuracy and clarity). For example, the line <code>wbt = WhiteboxTools()</code> creates an instance of a the <code>WhiteboxTools</code> class, which will later be used to call the <code>set_nodata_value</code> function. Feel free to discuss the script in groups and with your TA if there are portions of it that are unclear to you.</p>
</blockquote>
<p>Now, using your data visualization software (QGIS, ArcGIS, Whitebox GAT, etc.) display the <code>band2.tif</code> and <code>band6.tif</code> images. While the NoData edges have been removed by our processing, the contrast of the images is still being affected by the very high brightness of the clouds. We will examine ways of modifying image data to improve the contrast in a later lab assignment, but for now, you can quickly improve their display by adjusting the display minimum and maximum values. In each of QGIS, ArcGIS, and Whitebox GAT this involves clipping the display min/max values in <em>Layer Properties</em>/<em>Symbology</em> tabs. Note that this does not permanently modify the image, but only the way that it is being rendered in the software. </p>
<blockquote>
<p>2.4. Zoom into a grouping of the many clouds contained within the scene. Cloud cover, and particularly thick clouds, can significantly impact the usability of imagery for certain applications. Not only is the ground directly beneath clouds obscured from view, but clouds also cast shadow areas within images, which can degrade the overall image quality. Compare the appearance of clouds and areas of cloud shadows in the band 2 and band 6 images. Which of the two bands (i.e. regions of the electromagnetic spectrum) is more significantly impacted by cloud cover? Include screenshots of cloudy sections of the two images (zoomed in) to support your case. Why might there be differences in the impacts of clouds between the two images? (5 marks)</p>
<p>2.5. Locate Guelph Lake in the images. Guelph Lake is a relatively shallow reservoir. How does the appearance of the lake (or any waterbody for that matter) compare between the two images? What does this indicate about how the two regions of electromagnetic radiation captured by these two bands interact with water surfaces? (3 marks)</p>
<p>2.6. Add the panchromatic band 8 image (<code>band8.tif</code>) to the map and zoom into the Toronto waterfront area (you will likely need to stretch the palette for this image once displayed as well). How does the band 8 image compare to either of the other two displayed images in terms of level of detail? What is the spatial resolution of band 8 compared to the band 2? (4 marks)</p>
<p>2.7. The Landsat images are uncalibrated and the values that you see are simple digital numbers (DNs), which describe the relative brightness of a pixel in a unitless format. It is often necessary to calibrate images that are used for various applications (e.g. image classification) by converting the DNs to top-of-atmosphere (TOA) radiance values. This is accomplished by using multiplying each DN by a gain value and adding an offset. Read the following USGS link carefully <a href="https://www.usgs.gov/landsat-missions/using-usgs-landsat-level-1-data-product">https://www.usgs.gov/landsat-missions/using-usgs-landsat-level-1-data-product</a>, then using the band-specific information contained in the metadata file associated with the image data, provide the equations that would be used to convert bands 2, 3, and 4 (red, green, blue) of the OLI dataset into radiance values. (3 marks)</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="part1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="part3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="part1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="part3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
