<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Part 3: Image Filtering - GEOG3420 W24 Lab 3</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="part1.html"><strong aria-hidden="true">2.</strong> Part 1: HSI Transform</a></li><li class="chapter-item expanded "><a href="part2.html"><strong aria-hidden="true">3.</strong> Part 2: Principal Component Analysis</a></li><li class="chapter-item expanded "><a href="part3.html" class="active"><strong aria-hidden="true">4.</strong> Part 3: Image Filtering</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">GEOG3420 W24 Lab 3</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="part-3-image-filtering"><a class="header" href="#part-3-image-filtering">Part 3: Image Filtering</a></h1>
<p>Whitebox Workflows, and it's sister software WhiteboxTools, offers <a href="https://www.whiteboxgeo.com/manual/wbt_book/available_tools/image_processing_tools_filters.html">numerous tools</a> for filtering image data. Most of these filters can be grouped into some of the more common types based on their functionality:</p>
<ol>
<li>
<p><strong>Low-pass filters</strong>: These filters emphasize low-frequency, longer-range signals in the image and de-emphasize high-frequency, short-scale variations. They work to smooth the image and to reduce apparent noise. Examples of common low-pass filters include <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#mean_filter"><strong>mean_filter</strong></a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#gaussian_filter"><strong>gaussian_filter</strong></a>, and <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#median_filter"><strong>median_filter</strong></a>.</p>
</li>
<li>
<p><strong>Edge-preserving low-pass filters</strong>: Like other low-pass filters, this class of filters also aims to smooth images by emphasizing longer-range variation in the image. However, these filters also work to preserve the crispness of edges in the original image. Common examples include <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#bilateral_filter"><strong>bilateral_filter</strong></a>, and <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#edge_preserving_mean_filter"><strong>edge_preserving_mean_filter</strong></a>.</p>
</li>
<li>
<p><strong>High-pass filters</strong>: The opposite of a low-pass filter, these filters emphasize short-scale variation and de-emphasize longer-range signals. These tools are typically used to sharpen an image. The <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#unsharp_masking"><strong>unsharp_masking</strong></a> tool is a good example (despite its contrary name).</p>
</li>
<li>
<p><strong>Band-pass filters</strong>: These filters are used to isolate the variation in an image that lies between a lower and upper bound of specified ranges. The <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#diff_of_gaussian_filter"><strong>diff_of_gaussian_filter</strong></a> is a good example of this type of filter.</p>
</li>
<li>
<p><strong>Edge-detection filters</strong>: These filters are used to isolate the edge features within an image. Common examples include the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#sobel_filter"><strong>sobel_filter</strong></a> and <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#roberts_cross_filter"><strong>roberts_cross_filter</strong></a></p>
</li>
</ol>
<blockquote>
<p><strong>Readings:</strong> Mather and Koch. (2011). <em>Chapter 7 Filtering Techniques</em>.</p>
</blockquote>
<h2 id="image-smoothing-and-noise-reduction"><a class="header" href="#image-smoothing-and-noise-reduction">Image Smoothing and Noise Reduction</a></h2>
<p>You may recall from the previous section that PCA is sometimes used to remove noise from multi-spectral image datasets. Low-pass and edge-preserving low-pass filters similarly are used for reducing the occurrence of noise within images, although, unlike PCA, these operations are carried out on a single band (or the individual RGB components). Many satellite images contains substantial speckle, sometimes called <em>white noise</em>. Speckle refers to a high-frequency, short-spatial scale variation among neighouring pixels. To enhance the image and to improve its information content, it is necessary to remove this speckle. This is sometimes useful prior to image classification and other mapping applications where it can be good to reduce the within-patch variability (e.g., tonal variation, or texture, within agricultural fields) and to maximize the between-patch tonal distinctions (e.g., the differences between adjoining agricultural fields).</p>
<p>Apply a 5 × 5 mean filter to the <code>natural_colour_hsi.tif</code> image created in Part 1 using the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#mean_filter"><strong>mean_filter</strong></a> tool. To do so, we'll need to split this RGB composite image apart into its individual components, using the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#split_colour_composite"><strong>split_colour_composite</strong></a> and then add them back together after the filtering operation. </p>
<blockquote>
<p><strong>Note that the code in the script below will not work as is. It contains bugs and you'll need to be able to identify and fix them before you can run it. Debugging code is a major part of learning how to program. It involves interpreting error messages and various other skills (e.g. inserting print statements to help you determine where the program is failing).</strong></p>
</blockquote>
<p><em>mean_filter.py</em></p>
<pre><code class="language-python">import os
import whitebox_workflows

wbe = whitebox_workflows.WbEnvironment(&quot;floating-license-ID&quot;) # Initialize Whitebox

try:
    # declare your working directory as a variable
    wbe.working_directory = &quot;/path/to/lab/data&quot; # BE SURE TO UPDATE THIS
    assert(os.path.isdir(wbe.working_directory))

    wbe.verbose = False

    image = wbe.read_raster(&quot;natural_colour_hsi.tif&quot;)

    print(&quot;Break the image apart into its RGB components...&quot;)
    red, green, blue = wbe.split_colour_composite(composite_image=image)

    print(&quot;Filtering the images...)
    filter_size = 5 # Dictates the kernel size used in the filtering

    # Mean filter
    red_filtered = wbe.mean_filter(
        raster=red,
        filter_size_x=filter_size,
        filter_size_y=filter_size
    )

    green_filtered = wbe.mean_filter(
        raster=green,
        filter_size_x=filter_sise,
        filter_size_y=filter_size
    )

    blue_filtered = wbe.mean_filter(
        raster=blue,
        filter_size_x=filter_sise,
        filter_size_y=filter_size
    )

    print(&quot;Create a new composite...&quot;)
    natural_colour_filtered = wbe.create_colour_composite(
        reds=red_filtered,
        green=green_filtered,
        blue=blue_filtered,
        enhance=False
    )

    wbe.write_raster(natural_colour_filtered, &quot;natural_colour_filtered.tif&quot;, compress=True)

    print(&quot;Operation complete!&quot;) # Provide some sort of indication that the job is done.

except Exception as e:
    print(f&quot;Exception: {e}&quot;)

finally:
    print(wbe.check_in_license(&quot;floating-license-ID&quot;)) # Check your license back in.

</code></pre>
<p>Once the script has successfully run, open the resulting <code>natural_colour_filtered.tif</code> image display it using the data visualization software and compare it to the original <code>natural_colour_hsi.tif</code> image.</p>
<blockquote>
<p>3.1 What were the bugs in the script above? Briefly describe the process that you used to identify and rectify them. <strong>(2 mark)</strong></p>
<p>3.2. Describe the impact of the mean filter on the image? How does the filter impact the variation of tone (texture) with the larger land-cover patches (e.g. fields)? How does it impact the edges between patches as well as other linear features, such as roads? <strong>(5 mark)</strong></p>
</blockquote>
<p>One of the key characteristics of all spatial filters used in image processing is the kernel size, i.e. the size of the roving window. Modify the script so that it applies a 7 × 7 mean filter and compare the output to that of the 5 × 5 (be sure to change the output file name when you modify the script or you will overwrite the first filtered image).</p>
<blockquote>
<p>3.3. What was the impact of increasing the filter size? Why might you need to increase or decrease the window size of a filter? <strong>(3 mark)</strong></p>
</blockquote>
<p>Modify the script again, this time change the filter tool to perform a 7 × 7 <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#median_filter"><strong>median_filter</strong></a> being sure to modify the output file name, and a 7 × 7 <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#edge_preserving_mean_filter"><strong>edge_preserving_mean_filter</strong></a> (use parameters <code>threshold=40</code> and <code>filter_size=15</code>).</p>
<blockquote>
<p>3.4. How do the median and edge-preserving mean filters compare, with respect to their ability to smooth patches while preserving edges and linear features, to the earlier 7 × 7 mean filter? Which filter does the best job of smoothing the data while preserving the information contained in the edges defining spatial features like roads and field boundaries? <strong>(4 marks)</strong></p>
</blockquote>
<h3 id="edge-detection"><a class="header" href="#edge-detection">Edge Detection</a></h3>
<p>Spatial convolution filters can be used for many common image processing tasks other than noise reduction. One common task is edge-detection, which is often used during automated mapping operations. Apply a 3 × 3 <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#sobel_filter">Sobel edge-detection filter</a> to the <code>natural_colour_hsi.tif</code> image using the following script:</p>
<p><em>sobel.py</em></p>
<pre><code class="language-python">import os
import whitebox_workflows

wbe = whitebox_workflows.WbEnvironment(&quot;floating-license-ID&quot;) # Initialize Whitebox

try:
    # declare your working directory as a variable
    wbe.working_directory = &quot;/path/to/lab/data&quot; # BE SURE TO UPDATE THIS
    assert(os.path.isdir(wbe.working_directory))
    wbe.verbose = False

    image = wbe.read_raster(&quot;natural_colour_hsi.tif&quot;)
    sobel = wbe.sobel_filter(image, variant=&quot;3x3&quot;, clip_tails=1.0)
    wbe.write_raster(sobel, &quot;natural_colour_sobel.tif&quot;, compress=True)

    # Print the min/max values for the sobel image
    sobel.update_min_max()
    print(f&quot;Sobel min value: {sobel.configs.minimum}&quot;)
    print(f&quot;Sobel max value: {sobel.configs.maximum}&quot;)

    sobel_thresholded = sobel &gt; 1.5 # Threshold the image for high values
    sobel_thinned = wbe.line_thinning(sobel_thresholded) # Perform line-thinning to make the edges a single-cell wide
    wbe.write_raster(sobel_thinned, &quot;sobel_thresholded.tif&quot;, compress=True)

    print(&quot;Operation complete!&quot;) # Provide some sort of indication that the job is done.

except Exception as e:
    print(f&quot;Exception: {e}&quot;)

finally:
    print(wbe.check_in_license(&quot;floating-license-ID&quot;)) # Check your license back in.
</code></pre>
<p>Notice, that unlike the previous filters, we don't split the input colour composite image apart before applying the Sobel filter. This tool will work well with the RGB composite input image (in fact, each of the previous filters will also work on colour-composite images as well). When the script has successfully completed, display the resulting image using your data visualization software. </p>
<blockquote>
<p>Include a screenshot of the Sobel image (<em>natural_colour_sobel.tif</em>) with your Lab report <strong>(1 mark)</strong>.</p>
<p>3.5. How well does the filter work to highlight edges between adjacent land-use patches and linear features? <strong>(2 mark)</strong></p>
</blockquote>
<p>Typically, one would threshold a Sobel image (i.e. find all pixels greater than a threshold value) and then apply a <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#line_thinning"><strong>line thinning</strong></a> method to further refine the mapped edges, which we do in the script above. Display the high-value thresholded and line-thinned image, <em>sobel_thresholded.tif</em>. You can experiment with increasing or decreasing the threshold value (you should base this on the range of values in the Sobel image itself, <em>natural_colour_sobel.tif</em>) until you are satified with your final single-cell edge feature map.</p>
<blockquote>
<p>Include your a screenshot of the final edge map with your report. <strong>(1 mark)</strong>.</p>
<p>3.7. Compare the final Sobel edges map with the original colour-composite image. Describe the kinds of spatial features in the scene that are being mapped as edges by the algorithm. (<strong>2 marks</strong>)</p>
</blockquote>
<p>Modify the script above to run using the <strong>edge-preserving mean filter</strong> colour composite image created earlier as the input image.</p>
<blockquote>
<p>Include your modified script with your Lab report along with a screenshot of the edge-preserving sobel filtered image. <strong>(2 mark)</strong>.</p>
<p>3.6. To what extent does the use of a previously filtered image improve the detection of edge and linear features in the image rather than white-noise? <strong>(2 mark)</strong></p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="part2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="part2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
